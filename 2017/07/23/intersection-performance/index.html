<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/normalize.css">
  <link rel="stylesheet" href="/css/Torpedo.css">
  <link rel="stylesheet" href="/css/yewmint.css">
  <title>计算线段交点算法的性能 | Yewth</title>
</head>

  <body>
    <div id="wrapper">
      <header id="page-header">
  <div id="header-title">
    <a href="/">Yewth</a>
  </div>
  <div id="header-nav">
    <ul>
      
        <li><a target="_blank" class="menu-item " href="/">Index</a></li>
      
        <li><a target="_blank" class="menu-item " href="https://github.com/yewmint">GITHUB</a></li>
      
    </ul>
</header>

      <article class="article">
  <h1 id="-" class="article-title">计算线段交点算法的性能</h1>
  <p class="article-date">2017-07-23</p>
  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在许多几何算法，如多边形切割中，计算线段交点在总计算量中占据了很大比重。因此，对其进行性能评估，可以帮助提高许多算法的性能。</p>
<p>常用的线段交点算法，是利用两条线段的参数方程，构成一个线性方程组，通过克莱默法则解出唯一解，从而由参数推导出坐标。其算法在<a href="/2017/02/22/2D-visible-area/">2d可视区域</a>里已经详细讲解了。</p>
<p>上述算法虽然只需要四则运算，但是其每次需要10个乘除运算。对于那些本不可能相交的线段，也至少需要8个乘除运算。如果有一种简便的算法能提前判断线段是否相交，之后再进行交点运算，很可能会大量提高算法性能。</p>
<a id="more"></a>
<h2 id="判断是否相交"><a href="#判断是否相交" class="headerlink" title="判断是否相交"></a>判断是否相交</h2><p>目前常用的判断线段相交算法，是基于<strong>快速排斥检测</strong>和<strong>跨立检测</strong>。</p>
<p><strong>快速排斥检测</strong>：为两个线段建立轴一致包围盒，判断包围盒是否相交，如果不相交则线段不可能相交。只需比较运算和逻辑运算。</p>
<p><strong>跨立检测</strong>：对于线段<code>ab</code>和<code>cd</code>，判断<code>(ac) x (ab) * (ab) x (ad) &gt; 0 &amp;&amp; (ca) x (cd) * (cd) x (cb) &gt; 0</code>。其中，<code>(ac)</code>代表矢量，<code>x</code>代表矢量积。如果结果为真，则线段必相交。简化后的跨立检测只需要6个乘除运算。</p>
<p>首先利用<strong>快速排斥检测</strong>排除掉不可能相交的，再通过<strong>跨立检测</strong>确定一定相交的，最后进行交点的计算。</p>
<h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p>在50x50的方框内随机生成1000条线，对其两两求交点</p>
<p>测试用的代码在<a href="https://github.com/yewmint/demo-intersection-comparison" target="_blank" rel="external">GITHUB</a></p>
<p>测试结果：</p>
<ol>
<li>只进行<strong>快速排斥</strong>平均575ms</li>
<li>只进行<strong>跨立检测</strong>平均514ms</li>
<li>只进行求交点运算平均665ms</li>
<li>结合<strong>快速排斥</strong>、<strong>跨立检测</strong>和求交点运算平均924ms</li>
<li>结合<strong>跨立检测</strong>和求交点运算平均572ms</li>
</ol>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>直接求交点的速度不理想，而经过<strong>跨立测试</strong>排除后再求交点，速度提升了14%，十分可观。</p>
<p>测试出现了一个意外，快速排斥比跨立测试更慢，推测是因为创建AABB对象花费了额外的时间。实际应用中可以跳过创建AABB对象。</p>
<p>并且，在结合三个算法的测试中，速度反而不如直接求交点。原因之一是上述的对象创建花费，另一个原因则是在范围内完全随机的线段，其包围盒相交可能性十分高，导致快速排斥算法能排除的比例较小。因此，快速排斥算法更适合在稀疏线段的排除。</p>
<p><strong>全文完</strong></p>

</article>

      <footer>
  <div class="footer">
    &copy; 2015-2016 Yewmint, All rights reserved.
  </div>
</footer>

    </div>
  </body>
</html>
